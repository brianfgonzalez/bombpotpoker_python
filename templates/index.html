<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bombpot Poker</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Luckiest+Guy&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', 'Segoe UI', 'Arial', sans-serif;
            background: #1a2a3a;
            background-image: url("/static/casino-felt.jpg");
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
            color: #f3f4f6;
        }
        /* Overlap cards in player hand, leftmost card on top */
        .overlap-cards {
            display: flex;
            flex-direction: row-reverse;
            align-items: center;
        }
        .overlap-cards > * {
            margin-right: -1.7rem;
            z-index: 1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
        }
        .overlap-cards > *:first-child {
            margin-right: 0;
        }
        /* Style for select dropdown to ensure readable text */
        .custom-select {
            background-color: #232946 !important;
            color: #fff !important;
            border: 1px solid #393e46;
        }
        /* Make all dropdown options white text on dark background */
        .custom-select option, select.custom-select option {
            background-color: #232946 !important;
            color: #fff !important;
        }
        /* Poker chip effect for buttons */
        .poker-chip {
            background: radial-gradient(circle at 60% 40%, #f7c873 0%, #eab308 80%, #b8860b 100%);
            color: #232946;
            border: 2px solid #fff;
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            font-weight: bold;
            letter-spacing: 1px;
            transition: transform 0.1s, box-shadow 0.2s;
        }
        .poker-chip:hover {
            transform: scale(1.05);
            background: radial-gradient(circle at 60% 40%, #ffe082 0%, #facc15 80%, #b8860b 100%);
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
        }
        .poker-chip:active {
            transform: scale(0.97);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        /* Card style enhancements */
        .poker-card {
            background: linear-gradient(135deg, #fff 60%, #e2e8f0 100%);
            border: 2px solid #393e46;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            color: #232946;
            transition: transform 0.3s cubic-bezier(.4,2,.2,1), box-shadow 0.2s;
            transform-style: preserve-3d;
            perspective: 600px;
            min-height: 3.5rem; /* Ensure enough height for rank/suit */
            font-weight: bold;
        }
        .poker-card.flip-animate {
            transform: rotateY(180deg);
        }
        .poker-card:hover {
            transform: scale(1.08) rotate(-2deg);
            box-shadow: 0 8px 24px rgba(0,0,0,0.5);
            z-index: 2;
        }
        .poker-card.red {
            color: #e3342f;
            border-color: #e3342f;
        }
        .poker-card.black {
            color: #232946;
            border-color: #232946;
        }
        .poker-card.flipped {
            background: repeating-linear-gradient(
                135deg,
                #232946,
                #232946 10px,
                #393e46 10px,
                #393e46 20px
            );
            color: transparent;
            border-color: #393e46;
        }
        /* Responsive tweaks */
        @media (max-width: 768px) {
            .overlap-cards > * {
                margin-right: -1.2rem;
            }
            .poker-card {
                min-height: 5.2rem !important;
                width: 4rem !important;
                height: 5.2rem !important;
            }
            .w-14, .h-24 {
                width: 4rem !important;
                height: 5.2rem !important;
            }
            .flex-col.md\:flex-row {
                flex-direction: column !important;
            }
            .gap-10 {
                gap: 1.5rem !important;
            }
            .px-4, .pt-6 {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
                padding-top: 0.5rem !important;
            }
            .py-8 {
                padding-top: 1rem !important;
                padding-bottom: 1rem !important;
            }
            .mb-4, .mb-10 {
                margin-bottom: 1rem !important;
            }
            .rounded-xl {
                border-radius: 0.75rem !important;
            }
            .text-4xl {
                font-size: 2rem !important;
            }
            .text-lg {
                font-size: 1rem !important;
            }
            .w-14, .h-24 {
                width: 2.5rem !important;
                height: 3.5rem !important;
            }
            .p-6, .p-8 {
                padding: 1rem !important;
            }
            .px-6, .px-8 {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
        }
        .reveal-glow {
            box-shadow: 0 0 3px 1px #ffe082, 0 0 6px 2px #facc15;
            border-color: #ffe082 !important;
            background: linear-gradient(135deg, #ffe082 60%, #facc15 100%) !important;
            color: #232946 !important;
            animation: glow-pulse 1s infinite alternate;
        }
        .glow-select {
            box-shadow: 0 0 3px 1px #38bdf8, 0 0 6px 2px #0ea5e9;
            border-color: #38bdf8 !important;
            background: linear-gradient(135deg, #38bdf8 60%, #0ea5e9 100%) !important;
            color: #fff !important;
            animation: glow-pulse-select 1s infinite alternate;
        }
        @keyframes glow-pulse {
            from { box-shadow: 0 0 3px 1px #ffe082, 0 0 6px 2px #facc15; }
            to   { box-shadow: 0 0 6px 2px #ffe082, 0 0 9px 4px #facc15; }
        }
        @keyframes glow-pulse-select {
            from { box-shadow: 0 0 3px 1px #38bdf8, 0 0 6px 2px #0ea5e9; }
            to   { box-shadow: 0 0 6px 2px #38bdf8, 0 0 9px 4px #0ea5e9; }
        }
        @media (max-width: 1024px) {
            .max-w-xs, .max-w-xl, .max-w-5xl, .max-w-7xl {
                max-width: 100vw !important;
            }
        }
        @media (max-width: 500px) {
            .text-4xl {
                font-size: 1.3rem !important;
            }
            .text-lg {
                font-size: 0.9rem !important;
            }
            .w-14, .h-24 {
                width: 3.2rem !important;
                height: 4.2rem !important;
            }
            .poker-card {
                min-height: 4.2rem !important;
                width: 3.2rem !important;
                height: 4.2rem !important;
            }
            .rounded-xl {
                border-radius: 0.5rem !important;
            }
            .p-6, .p-8 {
                padding: 0.5rem !important;
            }
            .px-6, .px-8 {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
            }
        }
        /* Responsive rules box */
        .rules-mobile {
            position: static !important;
            top: unset !important;
            right: unset !important;
            z-index: unset !important;
            margin: 2rem auto 2rem auto !important;
            width: 100%;
            max-width: 100vw !important;
            border-radius: 0.75rem !important;
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
        }
        @media (max-width: 1024px) {
            .rules-mobile {
                max-width: 95vw !important;
            }
        }
        @media (max-width: 768px) {
            .rules-mobile {
                position: static !important;
                margin: 0.5rem 0 1rem 0;
                width: 100%;
                max-width: 100vw !important;
                border-radius: 0.75rem !important;
                z-index: 1 !important;
            }
            .rules-mobile-spacer {
                display: none !important;
            }
        }
        .rules-mobile-placeholder {
            display: none;
        }
        @media (max-width: 768px) {
            .rules-mobile-placeholder {
                display: block;
                height: 0;
                margin: 0;
                padding: 0;
            }
        }
        h1, .game-title {
            font-family: 'Luckiest Guy', cursive, sans-serif;
            letter-spacing: 2px;
            text-shadow: 2px 2px 12px #000, 0 0 12px #ffe082;
            color: #ffe082;
            transition: color 0.2s, transform 0.2s;
        }
        .game-title:hover {
            color: #fffbe7;
            transform: scale(1.04);
        }
        /* Add a simple spinner for loading */
        .spinner {
            border: 4px solid #232946;
            border-top: 4px solid #ffe082;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg);}
            100% { transform: rotate(360deg);}
        }
        .bg-opacity-80, .bg-opacity-90, .bg-opacity-95 {
            backdrop-filter: blur(2px) saturate(1.2);
        }
        .border-yellow-400 {
            box-shadow: 0 0 16px 2px #ffe08280;
        }
        .flex-col.items-center.mx-2.my-2:hover {
            background: rgba(46,204,113,0.08);
            border-radius: 0.75rem;
            box-shadow: 0 2px 12px 0 #ffe08240;
            transition: background 0.2s, box-shadow 0.2s;
        }
        /* Felt background for card and player hand containers */
        .felt-bg {
            background: url("/static/poker-felt.jpg");
            background-size: 300px 300px;
            background-repeat: repeat;
            background-position: center;
            border-radius: 1rem;
            box-shadow: 0 4px 24px 0 #00000040;
            border: 2px solid #2dd4bf;
            /* Add a subtle green overlay for depth */
            position: relative;
            overflow: hidden;
        }
        .felt-bg:before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(46,204,113,0.08) 0%, rgba(0,0,0,0.12) 100%);
            pointer-events: none;
            z-index: 1;
        }
        .felt-bg > * {
            position: relative;
            z-index: 2;
        }
        /* Optional: add a subtle overlay for contrast */
        .felt-bg-overlay {
            background: rgba(35,41,70,0.85);
            border-radius: 1rem;
        }
        /* Leaderboard improvements */
        table {
            border-radius: 0.75rem;
            overflow: hidden;
        }
        th, td {
            padding: 0.75rem 1rem;
        }
        th {
            background: #232946;
            color: #ffe082;
            font-weight: bold;
            letter-spacing: 1px;
        }
        tr:nth-child(even) {
            background: #232946;
        }
        tr:nth-child(odd) {
            background: #181e2a;
        }
        tr.bg-yellow-300 {
            background: #ffe082 !important;
            color: #232946 !important;
        }
        tr.bg-green-200 {
            background: #bbf7d0 !important;
            color: #232946 !important;
        }
        /* Button improvements */
        button:focus {
            outline: 2px solid #2dd4bf;
            outline-offset: 2px;
        }
        /* Responsive tweaks */
        @media (max-width: 768px) {
            .felt-bg {
                padding: 1rem !important;
            }
            .game-title {
                font-size: 2rem !important;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <noscript>
        <div style="color: #fff; background: #232946; padding: 2rem; border-radius: 1rem; text-align: center;">
            JavaScript is required to run Bombpot Poker.
        </div>
    </noscript>
    <script type="text/javascript">
        // Ensure React and ReactDOM are available
        const { useState, useEffect, useRef } = window.React;

        function Card({ rank, suit, flipped, animate }) {
            const isRed = suit === "♥" || suit === "♦";
            const isBlack = suit === "♠" || suit === "♣";
            const cardRef = useRef(null);

            useEffect(() => {
                if (animate && cardRef.current) {
                    cardRef.current.classList.add('flip-animate');
                    const timeout = setTimeout(() => {
                        cardRef.current.classList.remove('flip-animate');
                    }, 600);
                    return () => clearTimeout(timeout);
                }
            }, [animate]);

            return (
                React.createElement('div', {
                    ref: cardRef,
                    className: `w-14 h-24 rounded-xl flex flex-col justify-between items-end px-2 py-1 poker-card ${isRed ? "red" : ""} ${isBlack ? "black" : ""} ${flipped ? "flipped" : ""} relative`
                },
                    !flipped && [
                        React.createElement('span', { className: "text-lg font-bold", key: "rank" }, rank),
                        React.createElement('span', { className: "text-xl", key: "suit" }, suit)
                    ]
                )
            );
        }

        function PlayerHand({ player, idx }) {
            return React.createElement('div', { className: "flex flex-col items-center mx-2 my-2" },
                React.createElement('span', { className: "mb-2 text-base font-semibold text-yellow-300 drop-shadow" }, `Player ${idx + 1}`),
                React.createElement('div', { className: "overlap-cards" },
                    player.cards.map((card, i) =>
                        React.createElement(Card, { key: i, rank: card.rank, suit: card.suit })
                    )
                )
            );
        }

        function Flop({ flop, flopKey, onFlip, prediction, setPrediction, numPlayers, lastFlippedIndex, flops, highlightFourth, selectGlow, predictionOptions, canRevealFourth, predictionsLocked }) {
            // Show exposed and flipped cards in correct order, with flip animation for the last revealed
            const totalCards = (flop.exposed || []).length + (flop.flipped || []).length;
            const cards = [];
            const isTwoFlop = flops && flops.first_flop && flops.second_flop;
            const thisFlopFlipped = flop.flipped?.length || 0;
            const otherFlopFlipped = isTwoFlop
                ? flops[flopKey === "first_flop" ? "second_flop" : "first_flop"]?.flipped?.length || 0
                : 0;

            for (let i = 0; i < totalCards; i++) {
                if (i < (flop.exposed || []).length) {
                    cards.push(
                        React.createElement(Card, {
                            key: `exposed-${i}`,
                            rank: flop.exposed[i].rank,
                            suit: flop.exposed[i].suit,
                            flipped: false,
                            animate: lastFlippedIndex === i
                        })
                    );
                } else {
                    const flippedIdx = i - (flop.exposed || []).length;
                    let canReveal = true;
                    let extraClass = "";
                    // For the 4th card, only show "reveal" if canRevealFourth is true
                    if (thisFlopFlipped === 2 && flippedIdx === 0 && !canRevealFourth) {
                        canReveal = false;
                    }
                    // For the 5th card, only show "reveal" if both 4th cards are revealed
                    if (
                        isTwoFlop &&
                        thisFlopFlipped === 2 &&
                        flippedIdx === 1
                    ) {
                        canReveal = false;
                    }
                    if (
                        isTwoFlop &&
                        thisFlopFlipped === 1 &&
                        flippedIdx === 0 &&
                        (otherFlopFlipped > 1)
                    ) {
                        canReveal = false;
                    }
                    // Highlight the 4th card if requested and allowed
                    if (highlightFourth && thisFlopFlipped === 2 && flippedIdx === 0 && canRevealFourth) {
                        extraClass = "reveal-glow";
                    }
                    cards.push(
                        React.createElement('button', {
                            key: `flipped-${flippedIdx}`,
                            className:
                                "w-14 h-24 rounded-xl border-2 flex items-center justify-center font-bold mx-1 shadow-lg transition-all duration-300 " +
                                (canReveal ? (extraClass || "reveal-glow") : "border-gray-400 bg-gray-400 text-gray-200"),
                            onClick: canReveal ? () => onFlip(flopKey, flippedIdx) : undefined,
                            disabled: !canReveal,
                            "aria-label": "Flip card"
                        }, canReveal ? "reveal" : "")
                    );
                }
            }
            // Prediction dropdown options
            const options = predictionOptions || [];
            return React.createElement('div', { className: "flex flex-col items-center bg-[#232946] bg-opacity-80 rounded-xl p-4 shadow-lg min-w-[220px]" },
                React.createElement('span', { className: "text-yellow-300 font-bold mb-2 text-lg tracking-wide" }, flopKey === "first_flop" ? "First Flop" : "Second Flop"),
                React.createElement('div', { className: "mb-3" },
                    React.createElement('label', { className: "text-white mr-2 font-medium" }, "Prediction:"),
                    React.createElement('select', {
                        className: `rounded px-2 py-1 custom-select ${selectGlow ? "glow-select" : ""}`,
                        value: prediction,
                        onChange: e => setPrediction(e.target.value),
                        disabled: predictionsLocked
                    },
                        React.createElement('option', { value: "", disabled: true, hidden: true }, "Select Player"),
                        options.length > 0
                            ? options.map(opt =>
                                React.createElement('option', { key: opt, value: opt }, opt)
                            )
                            : Array.from({ length: numPlayers }, (_, i) =>
                                React.createElement('option', { key: i, value: `Player ${i + 1}` }, `Player ${i + 1}`)
                            )
                    )
                ),
                React.createElement('div', { className: "flex mt-2" }, cards)
            );
        }

        function FlopWithAnimation({ flop, flopKey, onFlip, prediction, setPrediction, numPlayers, lastFlippedIndex }) {
            // This version is used after a flip, to animate the newly revealed card
            return React.createElement('div', { className: "flex flex-col items-center bg-[#232946] bg-opacity-80 rounded-xl p-4 shadow-lg min-w-[220px]" },
                React.createElement('span', { className: "text-yellow-300 font-bold mb-2 text-lg tracking-wide" }, flopKey === "first_flop" ? "First Flop" : "Second Flop"),
                React.createElement('div', { className: "mb-3" },
                    React.createElement('label', { className: "text-white mr-2 font-medium" }, "Prediction:"),
                    React.createElement('select', {
                        className: "rounded px-2 py-1 custom-select",
                        value: prediction,
                        onChange: e => setPrediction(e.target.value)
                    },
                        Array.from({ length: numPlayers }, (_, i) =>
                            React.createElement('option', { key: i, value: `Player ${i + 1}` }, `Player ${i + 1}`)
                        )
                    )
                ),
                React.createElement('div', { className: "flex mt-2" },
                    [
                        ...((flop.exposed || []).map((card, i) =>
                            React.createElement(Card, {
                                key: `exposed-${i}`,
                                rank: card.rank,
                                suit: card.suit,
                                flipped: false,
                                animate: lastFlippedIndex === i
                            })
                        ))
                    ]
                )
            );
        }

        function describeHandType(handType, tiebreakers) {
            // handType: string or array (for two pair, one pair, etc)
            // tiebreakers: array of ranks, e.g. ['8', '2', '6'] or ['7', '10', '8', '6']
            if (Array.isArray(handType) && handType.length === 3) {
                // Two Pair: [highPair, lowPair, kicker]
                return `Two Pairs of ${handType[0]}s and ${handType[1]}s with a ${handType[2]} kicker`;
            }
            if (Array.isArray(handType) && handType.length > 1) {
                // One Pair: [pair, kicker1, kicker2, ...]
                return `Pair of ${handType[0]}s`;
            }
            if (typeof handType === "string") {
                return handType;
            }
            return String(handType);
        }

        function PokerGame() {
            console.log("PokerGame rendering");
            // --- TEMP: Minimal render for troubleshooting ---
            return React.createElement('div', { style: { color: 'yellow', fontSize: 32, textAlign: 'center', marginTop: '2rem' } }, "React is working!");
        }

        // Attach scrollToGameOptions to window so it can be called from outside React
        window.scrollToGameOptions = function() {
            const el = document.getElementById('game-options');
            if (el) {
                el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        };

        // Move all debug logs to the very top of the script
        console.log("Bombpot Poker script loaded");
        console.log("React version:", window.React && window.React.version);
        console.log("ReactDOM version:", window.ReactDOM && window.ReactDOM.version);
        console.log("PokerGame typeof:", typeof PokerGame);

        // --- Fix: Ensure script runs after all functions are defined ---
        // Remove window.addEventListener('DOMContentLoaded', ...) and replace with direct call at end of script

        function renderPokerGame() {
            const rootEl = document.getElementById('root');
            console.log("renderPokerGame: #root exists?", !!rootEl, "innerHTML:", rootEl && rootEl.innerHTML);
            if (!rootEl) {
                console.error("No #root element found!");
                return;
            }
            if (!window.React || !window.ReactDOM) {
                console.error("React or ReactDOM not loaded!");
                rootEl.innerHTML = "<div style='color:red'>React failed to load. Check your CDN links.</div>";
                return;
            }
            if (typeof PokerGame !== "function") {
                console.error("PokerGame is not defined or not a function. typeof PokerGame:", typeof PokerGame);
                rootEl.innerHTML = "<div style='color:red'>PokerGame is not defined. Check your script order.</div>";
                return;
            }
            try {
                if (window.ReactDOM.createRoot) {
                    window.ReactDOM.createRoot(rootEl).render(React.createElement(PokerGame));
                } else {
                    window.ReactDOM.render(React.createElement(PokerGame), rootEl);
                }
                console.log("ReactDOM.render called"); // <-- Add this line
            } catch (e) {
                console.error("React render error:", e);
                rootEl.innerHTML = "<div style='color:red'>React render error: " + e + "</div>";
            }
        }

        // --- Call renderPokerGame directly at the end of the script ---
        renderPokerGame();

    </script>
</body>
</html>